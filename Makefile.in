CORE=$(shell cat /proc/cpuinfo | grep 'processor' | wc -l)
all: ezvm ezas share

ezvm ezas: libezvm

ezvm ezas share:
	$(MAKE) -C src/$@

libezvm:
	$(MAKE) -C src/$@ -j$(CORE)

local install:
	$(MAKE) -C src/ezvm $@
	$(MAKE) -C src/libezvm $@
	$(MAKE) -C src/ezas $@
	$(MAKE) -C src/share $@

clean:
	$(MAKE) -C src/ezvm $@
	$(MAKE) -C src/libezvm $@
	$(MAKE) -C src/ezas $@
	$(MAKE) -C src/share $@
	rm -rf bin lib

distclean:
	$(MAKE) -C src/ezvm $@
	$(MAKE) -C src/libezvm $@
	$(MAKE) -C src/ezas $@
	$(MAKE) -C src/share $@
	rm -rf bin lib share
	find . -name *~ -exec rm {} \;
	rm -f Makefile 

test:
	bin/ezas share/ezvm/hello.ezas 
	bin/ezas share/ezvm/hello2.ezas 
	bin/ezas share/ezvm/swap.ezas 
	bin/ezas share/ezvm/add.ezas 
	bin/ezas share/ezvm/add2.ezas 
	bin/ezas share/ezvm/and.ezas 
	bin/ezas share/ezvm/and2.ezas 
	bin/ezas share/ezvm/div.ezas 
	bin/ezas share/ezvm/div2.ezas 
	bin/ezas share/ezvm/mod.ezas 
	bin/ezas share/ezvm/mod2.ezas 
	bin/ezas share/ezvm/mul.ezas 
	bin/ezas share/ezvm/mul2.ezas 
	bin/ezas share/ezvm/neg.ezas 
	bin/ezas share/ezvm/neg2.ezas 
	bin/ezas share/ezvm/or.ezas 
	bin/ezas share/ezvm/or2.ezas 
	bin/ezas share/ezvm/sub.ezas 
	bin/ezas share/ezvm/sub2.ezas 
	bin/ezas share/ezvm/xor.ezas 
	bin/ezas share/ezvm/xor2.ezas 
testg:
	bin/ezas share/ezvm/hello.ezas -l stderr -d stderr
	bin/ezas share/ezvm/hello2.ezas -l stderr -d stderr
	bin/ezas share/ezvm/swap.ezas -l stderr -d stderr
	bin/ezas share/ezvm/add.ezas -l stderr -d stderr
	bin/ezas share/ezvm/add2.ezas -l stderr -d stderr
	bin/ezas share/ezvm/and.ezas -l stderr -d stderr
	bin/ezas share/ezvm/and2.ezas -l stderr -d stderr
	bin/ezas share/ezvm/div.ezas -l stderr -d stderr
	bin/ezas share/ezvm/div2.ezas -l stderr -d stderr
	bin/ezas share/ezvm/mod.ezas -l stderr -d stderr
	bin/ezas share/ezvm/mod2.ezas -l stderr -d stderr
	bin/ezas share/ezvm/mul.ezas -l stderr -d stderr
	bin/ezas share/ezvm/mul2.ezas -l stderr -d stderr
	bin/ezas share/ezvm/neg.ezas -l stderr -d stderr
	bin/ezas share/ezvm/neg2.ezas -l stderr -d stderr
	bin/ezas share/ezvm/or.ezas -l stderr -d stderr
	bin/ezas share/ezvm/or2.ezas -l stderr -d stderr
	bin/ezas share/ezvm/sub.ezas -l stderr -d stderr
	bin/ezas share/ezvm/sub2.ezas -l stderr -d stderr
	bin/ezas share/ezvm/xor.ezas -l stderr -d stderr
	bin/ezas share/ezvm/xor2.ezas -l stderr -d stderr

