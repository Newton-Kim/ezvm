CORE=$(shell cat /proc/cpuinfo | grep 'processor' | wc -l)
all: ezvm ezas

ezvm ezas: libezvm

ezvm ezas:
	$(MAKE) -C src/$@

libezvm:
	$(MAKE) -C src/$@ -j$(CORE)

local install:
	$(MAKE) -C src/ezvm $@
	$(MAKE) -C src/libezvm $@
	$(MAKE) -C src/ezas $@

clean:
	$(MAKE) -C src/ezvm $@
	$(MAKE) -C src/libezvm $@
	$(MAKE) -C src/ezas $@
	rm -rf bin lib

distclean:
	$(MAKE) -C src/ezvm $@
	$(MAKE) -C src/libezvm $@
	$(MAKE) -C src/ezas $@
	rm -rf bin lib
	find . -name *~ -exec rm {} \;
	rm -f Makefile 

test:
	bin/ezas share/ezvm/hello.ezas -l stderr -d stderr
	bin/ezas share/ezvm/hello2.ezas -l stderr -d stderr
	bin/ezas share/ezvm/swap.ezas -l stderr -d stderr
