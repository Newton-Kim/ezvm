LIBRARY=libezvm.so.0.0.1
LINK_MAJOR=libezvm.so.0
LINK=libezvm.so
OBJS=vm.o \
	utility/ezfile.o \
	utility/ezlog.o

CXXFLAGS=-g -O2 -I../../include

all: $(LINK) $(LINK_MAJOR)

$(LINK) $(LINK_MAJOR): $(LIBRARY)
	ln -s $< $@

$(LIBRARY): $(OBJS)
	$(CXX) -shared -o $@ $^

local: ../../lib ../../lib/$(LIBRARY) ../../lib/$(LINK_MAJOR) ../../lib/$(LINK)
../../lib/$(LIBRARY):
	cp $(LIBRARY) $@
	
../../lib/$(LINK_MAJOR) ../../lib/$(LINK):
	ln -s $(LIBRARY) $@

../../lib:
	mkdir $@

install: $(INST_DIR)/lib $(INST_DIR)/lib/$(LIBRARY) $(INST_DIR)/lib/$(LINK_MAJOR) $(INST_DIR)/lib/$(LINK)

$(INST_DIR)/lib:
	install -d $@

$(INST_DIR)/lib/$(LIBRARY):
	install -s $(LIBRARY) $$(dirname "$@")

$(INST_DIR)/lib/$(LINK_MAJOR) $(INST_DIR)/lib/$(LINK):
	ln -s $(LIBRARY) $@

clean:
	rm -f $(LIBRARY) $(LINK_MAJOR) $(LINK) $(OBJS)

distclean: clean
	rm -f Makefile
