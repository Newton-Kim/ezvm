PROGRAM=ezas
OBJS=ezas.tab.o lex.yy.o ezas.o
CFLAGS=-g -O2 -std=gnu++11 -I../../include
CXXFLAGS=-g -O2 -std=gnu++11 -I../../include
LDFLAGS=-L../libezvm
LIBS=-lezvm -lfl

all: $(PROGRAM)

lex.yy.cc: ezas.l
	touch $@
	flex -o $@ $<

ezas.tab.cc: ezas.y
	bison $< -o $@ --defines=$@.h

$(PROGRAM): $(OBJS)
	$(CXX) -o $@ $^ $(LDFLAGS) $(LIBS)

local: ../../lib ../../lib/$(PROGRAM) ../../bin ../../bin/$(PROGRAM)

../../lib/$(PROGRAM): $(PROGRAM)
	cp $< $@

../../bin/$(PROGRAM): $(PROGRAM).in
	cp $< $@
	chmod a+x $@

../../lib ../../bin:
	mkdir $@

install: $(INST_DIR)/bin $(INST_DIR)/bin/$(PROGRAM)

$(INST_DIR)/bin:
	install -d $@

$(INST_DIR)/bin/$(PROGRAM): $(PROGRAM)
	install -s $< $$(dirname "$@")

clean:
	rm -f $(PROGRAM) $(OBJS) lex.yy.cc ezas.tab.cc ezas.tab.cc.h

distclean: clean
	rm -f Makefile
